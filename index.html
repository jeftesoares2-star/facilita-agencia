<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Facilita AgÃªncia â€” Pacotes On Demand</title>
<meta name="theme-color" content="#06b6d4">
<style>
:root{--bg:#071228;--card:#0f172a;--accent:#06b6d4;--muted:#94a3b8;--white:#eef2ff}
body{margin:0;font-family:Arial,Helvetica,sans-serif;background:var(--bg);color:var(--white);padding:12px}
h1{font-size:20px;margin:0 0 8px 0}
.card{background:#0f172a;padding:12px;border-radius:10px;margin-top:12px}
.btn-row{display:flex;gap:8px;justify-content:space-between;margin-bottom:10px}
.big-btn{flex:1;padding:12px;border-radius:10px;border:0;font-weight:700;font-size:17px;cursor:pointer}
.P{background:#16a34a;color:#061a10}
.M{background:#2563eb;color:#eaf2ff}
.G{background:#dc2626;color:#fff}
input, select, button {width:100%;padding:10px;border-radius:8px;border:0;background:rgba(255,255,255,0.03);color:var(--white);margin-top:8px;font-size:16px}
#pendingList, #deliveredList{max-height:260px;overflow:auto;margin-top:8px}
.item{background:rgba(255,255,255,0.02);padding:8px;border-radius:8px;margin-top:8px;display:flex;justify-content:space-between;align-items:center}
.label{font-weight:700;font-size:20px}
.small{color:var(--muted);font-size:13px;margin-top:6px}
.actions button{padding:6px;border-radius:6px;border:0;background:#1f2937;color:#fff;font-size:14px}
/* etiqueta flutuante */
.floatingLabel{
  position:fixed;
  top:20px; left:50%;
  transform:translateX(-50%);
  background:#2563eb;
  color:#fff;
  font-size:24px;
  font-weight:700;
  padding:12px 20px;
  border-radius:10px;
  box-shadow:0 4px 14px rgba(0,0,0,0.4);
  z-index:9999;
  display:none;
  animation:fadeInOut 2s forwards;
}
@keyframes fadeInOut{
  0%{opacity:0; transform:translate(-50%, -20px);}
  10%{opacity:1; transform:translate(-50%,0);}
  90%{opacity:1; transform:translate(-50%,0);}
  100%{opacity:0; transform:translate(-50%,-20px);}
}
</style>
</head>
<body>

<h1>ðŸ“¦ Facilita AgÃªncia â€” On Demand</h1>

<div class="card">
  <div class="small">Bipe o cÃ³digo do cliente</div>
  <input id="codigo" placeholder="Bipe ou digite o cÃ³digo do cliente" inputmode="numeric" maxlength="24"/>
  
  <div class="small" style="margin-top:12px">Escolha o tamanho do pacote</div>
  <div class="btn-row">
    <button id="btnP" class="big-btn P">P</button>
    <button id="btnM" class="big-btn M">M</button>
    <button id="btnG" class="big-btn G">G</button>
  </div>
</div>

<div class="card">
  <h3>ðŸ“‹ Pacotes Pendentes</h3>
  <div id="pendingList"></div>
</div>

<div class="card">
  <h3>ðŸ“‹ Pacotes Entregues</h3>
  <div id="deliveredList"></div>
</div>

<div id="floatingLabel" class="floatingLabel"></div>

<script>
/* CONFIG */
const STORAGE_KEY='FACILITA_DB_V3';
let DB = JSON.parse(localStorage.getItem(STORAGE_KEY) || 'null');
if(!DB) DB={registros:[],contadores:{P:0,M:0,G:0},livres:{P:[],M:[],G:[]},entregues:[],codesUsed:{}};

/* UI refs */
const codigoInput=document.getElementById('codigo');
const btnP=document.getElementById('btnP');
const btnM=document.getElementById('btnM');
const btnG=document.getElementById('btnG');
const pendingList=document.getElementById('pendingList');
const deliveredList=document.getElementById('deliveredList');
const floatingLabel=document.getElementById('floatingLabel');

let selectedSize=null;

/* UTIL */
function save(){localStorage.setItem(STORAGE_KEY,JSON.stringify(DB));}
function showFloatingLabel(msg){floatingLabel.textContent=msg; floatingLabel.style.display='block'; setTimeout(()=>{floatingLabel.style.display='none';},2000);}
function nextNum(t){if(DB.livres[t].length){return DB.livres[t].shift();} DB.contadores[t]=(DB.contadores[t]||0)+1; return DB.contadores[t];}
function makeLabel(t,n){return t+n;}

/* Size buttons */
btnP.addEventListener('click',()=>{selectedSize='P'; showFloatingLabel('Tamanho P selecionado');});
btnM.addEventListener('click',()=>{selectedSize='M'; showFloatingLabel('Tamanho M selecionado');});
btnG.addEventListener('click',()=>{selectedSize='G'; showFloatingLabel('Tamanho G selecionado');});

/* Alocar pacote */
function allocate(code){
  if(!code) return;
  if(DB.codesUsed[code]){ // jÃ¡ existe
    const rec=DB.registros.find(r=>r.codigo===code);
    if(rec){showFloatingLabel(`CÃ³digo jÃ¡ cadastrado: ${rec.etiqueta}`); return;}
  }
  if(!selectedSize){showFloatingLabel('Escolha o tamanho antes'); return;}
  const num=nextNum(selectedSize);
  const label=makeLabel(selectedSize,num);
  const rec={codigo:code,etiqueta:label,tamanho:selectedSize,num:num,ts:Date.now()};
  DB.registros.push(rec);
  DB.codesUsed[code]=true;
  save();
  refreshLists();
  showFloatingLabel(`Gerado: ${label}`);
  codigoInput.value='';
}

/* Entregar pacote */
function deliver(code){
  const recIndex=DB.registros.findIndex(r=>r.codigo===code);
  if(recIndex===-1){showFloatingLabel('CÃ³digo nÃ£o encontrado'); return;}
  const rec=DB.registros.splice(recIndex,1)[0];
  DB.entregues.push(rec);
  save();
  refreshLists();
  showFloatingLabel(`Pacote entregue: ${rec.etiqueta}`);
}

/* Refresh lists */
function refreshLists(){
  pendingList.innerHTML='';
  DB.registros.forEach(r=>{
    const div=document.createElement('div');
    div.className='item';
    div.innerHTML=`<div><div class="label">${r.etiqueta}</div><div class="small">${r.codigo} â€¢ ${r.tamanho}</div></div>
      <div class="actions"><button onclick="deliver('${r.codigo}')">Entregar</button></div>`;
    pendingList.appendChild(div);
  });
  deliveredList.innerHTML='';
  DB.entregues.forEach(r=>{
    const div=document.createElement('div');
    div.className='item';
    div.innerHTML=`<div><div class="label">${r.etiqueta}</div><div class="small">${r.codigo} â€¢ ${r.tamanho}</div></div>`;
    deliveredList.appendChild(div);
  });
}

/* Input listener (leitor externo ou digitaÃ§Ã£o) */
codigoInput.addEventListener('change',(e)=>{
  const code=e.target.value.trim();
  if(!code) return;
  const exists=DB.registros.find(r=>r.codigo===code);
  if(exists){ // cliente chegou retirar
    deliver(code);
  }else{
    allocate(code);
  }
});

/* init */
refreshLists();
</script>

</body>
</html>
